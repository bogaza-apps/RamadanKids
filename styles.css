/* ============ THEME VARIABLES ============ */

/* ── Shared base (non-color) ── */
:root {
  --r:18px;
  --font:'Tajawal',sans-serif;
}

/* ── Night Theme (default) ── */
:root,[data-theme="night"]{
  color-scheme: dark;
  /* Background layers */
  --color-bg:           #0d1b3e;
  --color-bg-surface:   #162040;
  --color-bg-raised:    #1e2e58;
  /* Surface alpha */
  --color-surf-low:     rgba(255,255,255,0.06);
  --color-surf-mid:     rgba(255,255,255,0.11);
  /* Border */
  --color-border:       rgba(245,183,49,0.22);
  /* Primary — warm gold */
  --color-primary:      #f5b731;
  --color-primary-dim:  #fdd87a;
  --color-primary-deep: #c98a00;
  --color-on-primary:   #1a0e00;
  /* Secondary — teal */
  --color-secondary:     #34c4ab;
  --color-secondary-dim: #7de8d5;
  --color-on-secondary:  #ffffff;
  /* Tertiary — violet */
  --color-tertiary:     #9b6dff;
  --color-on-tertiary:  #ffffff;
  /* Text */
  --color-text:         #ede4d3;
  --color-text-muted:   #8fa8c8;
  --color-text-faint:   rgba(237,228,211,0.40);
  /* States */
  --color-success:       #3dd68c;
  --color-success-dark:  #1e8a4a;
  --color-success-glow:  rgba(61,214,140,0.30);
  --color-on-success:    #ffffff;
  --color-danger:        #f26c6c;
  --color-danger-dark:   #b92d2d;
  --color-danger-glow:   rgba(242,108,108,0.30);
  --color-on-danger:     #ffffff;
  --color-warning:       #f5b731;
  --color-warning-dark:  #c98a00;
  --color-on-warning:    #1a0e00;
  --color-info:          #34c4ab;
  /* UI states */
  --color-disabled-bg:   rgba(255,255,255,0.07);
  --color-disabled-text: rgba(255,255,255,0.30);
  --color-focus-ring:    rgba(245,183,49,0.55);
  --color-overlay:       rgba(0,0,0,0.72);
  /* Shadows */
  --shadow-sm:  0 4px 12px rgba(0,0,0,0.30);
  --shadow-md:  0 8px 32px rgba(0,0,0,0.50);

  /* ── Legacy aliases (zero-breakage) ── */
  --bg:var(--color-bg);--bg2:var(--color-bg-surface);--bg3:var(--color-bg-raised);
  --accent:var(--color-primary);--accent2:var(--color-primary-dim);--accent3:var(--color-primary-deep);
  --teal:var(--color-secondary);--teal2:var(--color-secondary-dim);
  --rose:var(--color-danger);--green:var(--color-success);--purple:var(--color-tertiary);
  --text:var(--color-text);--muted:var(--color-text-muted);
  --text-on-accent:var(--color-on-primary);
  --text-on-teal:var(--color-on-secondary);
  --text-on-green:var(--color-on-success);
  --text-on-rose:var(--color-on-danger);
  --text-on-done:var(--color-on-success);
  --surf:var(--color-surf-low);--surf2:var(--color-surf-mid);--bdr:var(--color-border);
  --shadow:var(--shadow-md);
}

/* ── Day Theme — warm parchment ── */
[data-theme="day"]{
  color-scheme: light;
  --color-bg:           #faf5ec;
  --color-bg-surface:   #fffcf2;
  --color-bg-raised:    #fff4d6;
  --color-surf-low:     rgba(0,0,0,0.04);
  --color-surf-mid:     rgba(0,0,0,0.08);
  --color-border:       rgba(176,112,0,0.22);
  --color-primary:      #b07000;
  --color-primary-dim:  #d4920a;
  --color-primary-deep: #7a4a00;
  --color-on-primary:   #ffffff;
  --color-secondary:     #007a65;
  --color-secondary-dim: #00a885;
  --color-on-secondary:  #ffffff;
  --color-tertiary:     #6a1fb0;
  --color-on-tertiary:  #ffffff;
  --color-text:         #1a0e00;
  --color-text-muted:   #6b4a18;
  --color-text-faint:   rgba(26,14,0,0.40);
  --color-success:       #1a7a30;
  --color-success-dark:  #0f5220;
  --color-success-glow:  rgba(26,122,48,0.15);
  --color-on-success:    #ffffff;
  --color-danger:        #c0001e;
  --color-danger-dark:   #8a0015;
  --color-danger-glow:   rgba(192,0,30,0.12);
  --color-on-danger:     #ffffff;
  --color-warning:       #b07000;
  --color-warning-dark:  #7a4a00;
  --color-on-warning:    #ffffff;
  --color-info:          #007a65;
  --color-disabled-bg:   rgba(0,0,0,0.06);
  --color-disabled-text: rgba(26,14,0,0.30);
  --color-focus-ring:    rgba(176,112,0,0.50);
  --color-overlay:       rgba(0,0,0,0.60);
  --shadow-sm:  0 2px 8px rgba(0,0,0,0.10);
  --shadow-md:  0 4px 20px rgba(0,0,0,0.12);

  --bg:var(--color-bg);--bg2:var(--color-bg-surface);--bg3:var(--color-bg-raised);
  --accent:var(--color-primary);--accent2:var(--color-primary-dim);--accent3:var(--color-primary-deep);
  --teal:var(--color-secondary);--teal2:var(--color-secondary-dim);
  --rose:var(--color-danger);--green:var(--color-success);--purple:var(--color-tertiary);
  --text:var(--color-text);--muted:var(--color-text-muted);
  --text-on-accent:var(--color-on-primary);
  --text-on-teal:var(--color-on-secondary);
  --text-on-green:var(--color-on-success);
  --text-on-rose:var(--color-on-danger);
  --text-on-done:var(--color-on-success);
  --surf:var(--color-surf-low);--surf2:var(--color-surf-mid);--bdr:var(--color-border);
  --shadow:var(--shadow-md);
}

/* ── Girls Theme — blossom & magic ── */
[data-theme="girls"]{
  color-scheme: light;
  --color-bg:           #fff4f9;
  --color-bg-surface:   #fff0f7;
  --color-bg-raised:    #ffe4f1;
  --color-surf-low:     rgba(212,0,110,0.05);
  --color-surf-mid:     rgba(212,0,110,0.10);
  --color-border:       rgba(212,0,110,0.18);
  --color-primary:      #d4006e;
  --color-primary-dim:  #f0209a;
  --color-primary-deep: #96004c;
  --color-on-primary:   #ffffff;
  --color-secondary:     #8c22e0;
  --color-secondary-dim: #b44eff;
  --color-on-secondary:  #ffffff;
  --color-tertiary:     #00b8a0;
  --color-on-tertiary:  #ffffff;
  --color-text:         #2a0016;
  --color-text-muted:   #7a2855;
  --color-text-faint:   rgba(42,0,22,0.40);
  --color-success:       #28a060;
  --color-success-dark:  #1a7040;
  --color-success-glow:  rgba(40,160,96,0.15);
  --color-on-success:    #ffffff;
  --color-danger:        #c40032;
  --color-danger-dark:   #8c0025;
  --color-danger-glow:   rgba(196,0,50,0.12);
  --color-on-danger:     #ffffff;
  --color-warning:       #d4006e;
  --color-warning-dark:  #96004c;
  --color-on-warning:    #ffffff;
  --color-info:          #8c22e0;
  --color-disabled-bg:   rgba(212,0,110,0.06);
  --color-disabled-text: rgba(42,0,22,0.30);
  --color-focus-ring:    rgba(212,0,110,0.45);
  --color-overlay:       rgba(40,0,20,0.65);
  --shadow-sm:  0 2px 8px rgba(150,0,80,0.10);
  --shadow-md:  0 4px 20px rgba(150,0,80,0.14);

  --bg:var(--color-bg);--bg2:var(--color-bg-surface);--bg3:var(--color-bg-raised);
  --accent:var(--color-primary);--accent2:var(--color-primary-dim);--accent3:var(--color-primary-deep);
  --teal:var(--color-secondary);--teal2:var(--color-secondary-dim);
  --rose:var(--color-danger);--green:var(--color-success);--purple:var(--color-tertiary);
  --text:var(--color-text);--muted:var(--color-text-muted);
  --text-on-accent:var(--color-on-primary);
  --text-on-teal:var(--color-on-secondary);
  --text-on-green:var(--color-on-success);
  --text-on-rose:var(--color-on-danger);
  --text-on-done:var(--color-on-success);
  --surf:var(--color-surf-low);--surf2:var(--color-surf-mid);--bdr:var(--color-border);
  --shadow:var(--shadow-md);
}

/* ── Boys Theme — forest & adventure ── */
[data-theme="boys"]{
  color-scheme: light;
  --color-bg:           #f0f8f2;
  --color-bg-surface:   #e8f5ec;
  --color-bg-raised:    #d4eedb;
  --color-surf-low:     rgba(28,120,0,0.05);
  --color-surf-mid:     rgba(28,120,0,0.10);
  --color-border:       rgba(28,120,0,0.20);
  --color-primary:      #1c7800;
  --color-primary-dim:  #2aaa00;
  --color-primary-deep: #0f4d00;
  --color-on-primary:   #ffffff;
  --color-secondary:     #0068a8;
  --color-secondary-dim: #0090d8;
  --color-on-secondary:  #ffffff;
  --color-tertiary:     #d46800;
  --color-on-tertiary:  #ffffff;
  --color-text:         #081808;
  --color-text-muted:   #3a5a30;
  --color-text-faint:   rgba(8,24,8,0.40);
  --color-success:       #1c7800;
  --color-success-dark:  #0f4d00;
  --color-success-glow:  rgba(28,120,0,0.18);
  --color-on-success:    #ffffff;
  --color-danger:        #c23000;
  --color-danger-dark:   #8a2000;
  --color-danger-glow:   rgba(194,48,0,0.15);
  --color-on-danger:     #ffffff;
  --color-warning:       #d46800;
  --color-warning-dark:  #9a4a00;
  --color-on-warning:    #ffffff;
  --color-info:          #0068a8;
  --color-disabled-bg:   rgba(28,120,0,0.06);
  --color-disabled-text: rgba(8,24,8,0.30);
  --color-focus-ring:    rgba(28,120,0,0.45);
  --color-overlay:       rgba(0,20,0,0.65);
  --shadow-sm:  0 2px 8px rgba(0,60,0,0.08);
  --shadow-md:  0 4px 20px rgba(0,60,0,0.12);

  --bg:var(--color-bg);--bg2:var(--color-bg-surface);--bg3:var(--color-bg-raised);
  --accent:var(--color-primary);--accent2:var(--color-primary-dim);--accent3:var(--color-primary-deep);
  --teal:var(--color-secondary);--teal2:var(--color-secondary-dim);
  --rose:var(--color-danger);--green:var(--color-success);--purple:var(--color-tertiary);
  --text:var(--color-text);--muted:var(--color-text-muted);
  --text-on-accent:var(--color-on-primary);
  --text-on-teal:var(--color-on-secondary);
  --text-on-green:var(--color-on-success);
  --text-on-rose:var(--color-on-danger);
  --text-on-done:var(--color-on-success);
  --surf:var(--color-surf-low);--surf2:var(--color-surf-mid);--bdr:var(--color-border);
  --shadow:var(--shadow-md);
}

/* ============ BASE ============ */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{font-size:16px}
body{
  font-family:var(--font);background:var(--bg);color:var(--text);
  direction:rtl;text-align:right;min-height:100vh;
  overflow-x:hidden;-webkit-tap-highlight-color:transparent;
  transition:background 0.3s,color 0.3s;
}
/* Focus ring accessibility */
*:focus{outline:none}
*:focus-visible{outline:3px solid var(--color-focus-ring);outline-offset:2px;border-radius:4px}
body::before{
  content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background:radial-gradient(1px 1px at 20% 30%,rgba(255,255,255,0.4) 0%,transparent 100%),
    radial-gradient(1px 1px at 60% 20%,rgba(255,255,255,0.5) 0%,transparent 100%),
    radial-gradient(1px 1px at 80% 70%,rgba(255,255,255,0.3) 0%,transparent 100%),
    radial-gradient(1px 1px at 35% 55%,rgba(245,183,49,0.30) 0%,transparent 100%);
}
[data-theme="day"] body::before{
  background:radial-gradient(1px 1px at 35% 55%,rgba(176,112,0,0.20) 0%,transparent 100%);
  opacity:0.3;
}
[data-theme="girls"] body::before{
  background:radial-gradient(1px 1px at 35% 55%,rgba(212,0,110,0.15) 0%,transparent 100%),
    radial-gradient(1px 1px at 70% 25%,rgba(140,34,224,0.12) 0%,transparent 100%);
  opacity:0.25;
}
[data-theme="boys"] body::before{
  background:radial-gradient(1px 1px at 35% 55%,rgba(28,120,0,0.15) 0%,transparent 100%),
    radial-gradient(1px 1px at 65% 30%,rgba(0,104,168,0.12) 0%,transparent 100%);
  opacity:0.25;
}
#app{max-width:520px;margin:0 auto;min-height:100vh;position:relative;z-index:1;padding-bottom:90px}

/* ====== RAMADAN PATH MAP ====== */
/* ====== RAMADAN GAME PATH MAP ====== */
#ramadan-path-map{padding:10px 0 20px;position:relative;user-select:none}
.rpath-row{display:flex;align-items:center;justify-content:center;gap:0;margin-bottom:0;position:relative}
.rpath-row.rtl-row{flex-direction:row-reverse}

/* The path connector line */
.rpath-line{flex:1;height:6px;border-radius:3px;background:var(--bdr);position:relative;min-width:10px;max-width:32px}
.rpath-line.done-line{background:linear-gradient(90deg,var(--color-success),var(--color-success-dark))}
.rpath-line.today-line{background:linear-gradient(90deg,var(--color-success),var(--color-primary))}

/* Vertical connector between rows */
.rpath-vline-wrap{display:flex;align-items:center;justify-content:flex-start;padding-right:24px;margin:0}
.rpath-vline-wrap.rtl-side{justify-content:flex-end;padding-right:0;padding-left:24px}
.rpath-vline{width:6px;height:28px;border-radius:3px;background:var(--bdr)}
.rpath-vline.done-vline{background:linear-gradient(180deg,var(--color-success),var(--color-success-dark))}

/* Day node */
.rday{width:52px;height:52px;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;font-family:var(--font);cursor:default;position:relative;flex-shrink:0;transition:transform .2s;border:3px solid transparent}

/* States */
.rday.rd-done{background:linear-gradient(135deg,var(--color-success),var(--color-success-dark));border-color:var(--color-success-dark);box-shadow:0 3px 10px var(--color-success-glow)}
.rday.rd-done .rday-num{color:var(--color-on-success);font-weight:900;font-size:0.9rem}
.rday.rd-done .rday-icon{font-size:1rem}

.rday.rd-missed{background:linear-gradient(135deg,var(--color-danger),var(--color-danger-dark));border-color:var(--color-danger-dark);box-shadow:0 3px 8px var(--color-danger-glow)}
.rday.rd-missed .rday-num{color:var(--color-on-danger);font-weight:900;font-size:0.9rem}
.rday.rd-missed .rday-icon{font-size:1rem}

.rday.rd-today{background:linear-gradient(135deg,var(--color-primary),var(--color-primary-deep));border-color:var(--color-primary);box-shadow:0 0 0 4px var(--color-focus-ring),0 3px 12px var(--color-focus-ring);animation:pulse-today 2s ease-in-out infinite}
.rday.rd-today .rday-num{color:var(--color-on-primary);font-weight:900;font-size:0.9rem}
.rday.rd-today .rday-icon{font-size:1.1rem}

.rday.rd-locked{background:var(--surf2);border-color:var(--bdr);opacity:0.5}
.rday.rd-locked .rday-num{color:var(--muted);font-size:0.85rem}
.rday.rd-locked .rday-icon{font-size:0.85rem}

/* Milestone nodes (days 7,14,21,30) — bigger */
.rday.rd-milestone{width:62px;height:62px}
.rday.rd-milestone .rday-num{font-size:0.95rem}
.rday.rd-milestone .rday-icon{font-size:1.3rem}

.rday-num{line-height:1;margin-bottom:1px}
.rday-icon{line-height:1}

@keyframes pulse-today{
  0%,100%{box-shadow:0 0 0 4px var(--color-focus-ring),0 3px 12px var(--color-focus-ring)}
  50%{box-shadow:0 0 0 8px rgba(0,0,0,0.05),0 3px 16px var(--color-focus-ring)}
}

/* Path legend */
.path-legend{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:8px;margin-bottom:16px}
.legend-item{display:flex;align-items:center;gap:5px;font-size:0.72rem;color:var(--muted)}
.legend-dot{width:12px;height:12px;border-radius:50%}

/* Milestone label */
.milestone-label{position:absolute;top:-22px;left:50%;transform:translateX(-50%);white-space:nowrap;font-size:0.62rem;font-weight:700;color:var(--color-primary);background:var(--color-surf-low);border:1px solid var(--color-border);padding:1px 6px;border-radius:8px}

#ramadan-path-map{padding:10px 0 20px;position:relative}
.path-section{position:relative;padding:0 8px}
.path-row{display:flex;align-items:flex-end;justify-content:center;padding:4px 0}
.path-row.ltr{flex-direction:row}
.path-row.rtl{flex-direction:row-reverse}
.path-node{display:flex;flex-direction:column;align-items:center;width:60px;flex-shrink:0;position:relative}
.path-connector{width:14px;height:4px;background:var(--bdr);border-radius:2px;align-self:center;margin-bottom:26px;flex-shrink:0}
.path-connector.done-conn{background:var(--color-success)}
.path-connector.miss-conn{background:var(--color-danger)}
.path-connector.today-conn{background:linear-gradient(90deg,var(--color-success),var(--color-primary))}

.path-btn{width:52px;height:52px;border-radius:50%;border:3px solid var(--bdr);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  font-size:1.25rem;position:relative;transition:transform .15s;
  background:var(--surf2);box-shadow:0 3px 8px rgba(0,0,0,.25);cursor:default}
.path-btn .day-num{font-size:0.58rem;font-weight:900;line-height:1;margin-top:1px;color:rgba(255,255,255,.85)}
.path-btn .day-lbl{font-size:0.6rem;font-weight:700;margin-top:4px;color:var(--muted);text-align:center;max-width:58px;line-height:1.2;white-space:nowrap}

.path-btn.st-done{background:linear-gradient(145deg,var(--color-success),var(--color-success-dark));border-color:var(--color-success-dark);box-shadow:0 4px 12px var(--color-success-glow)}
.path-btn.st-today{background:linear-gradient(145deg,var(--color-primary),var(--color-primary-deep));border-color:var(--color-primary);width:60px;height:60px;font-size:1.45rem;
  box-shadow:0 0 0 5px var(--color-focus-ring),0 4px 16px var(--color-focus-ring);
  animation:pulseToday 2s ease-in-out infinite}
.path-btn.st-missed{background:linear-gradient(145deg,var(--color-danger),var(--color-danger-dark));border-color:var(--color-danger-dark);box-shadow:0 4px 12px var(--color-danger-glow)}
.path-btn.st-locked{background:var(--surf);border-color:var(--bdr);opacity:.5}
.path-btn.st-done .day-num,.path-btn.st-today .day-num,.path-btn.st-missed .day-num{color:var(--color-on-primary)}
@keyframes pulseToday{0%,100%{box-shadow:0 0 0 5px var(--color-focus-ring),0 4px 16px var(--color-focus-ring)}50%{box-shadow:0 0 0 10px rgba(0,0,0,0.04),0 4px 20px var(--color-focus-ring)}}

/* SVG curve between rows */
.path-turn{display:flex;justify-content:center;height:34px;overflow:visible;margin:0 4px}
.path-milestone{background:var(--color-surf-low);border:1.5px solid var(--color-primary);border-radius:12px;
  padding:6px 14px;margin:8px 14px 10px;text-align:center;font-size:0.78rem;
  font-weight:700;color:var(--color-primary);display:flex;align-items:center;justify-content:center;gap:6px}

/* Parent tab buttons — 2-row grid */
.ptab-btn{background:var(--surf);border:1.5px solid var(--bdr);border-radius:12px;padding:10px 6px;
  font-family:var(--font);font-size:0.78rem;font-weight:700;color:var(--muted);cursor:pointer;
  display:flex;flex-direction:column;align-items:center;gap:4px;transition:all .15s;min-height:58px;line-height:1.2}
.ptab-btn span{font-size:0.75rem}
.ptab-btn.active,.ptab-btn:active{background:var(--color-primary);border-color:var(--color-primary);color:var(--color-on-primary)}
.ptab-btn:hover:not(.active){border-color:var(--accent);color:var(--accent)}

/* ===== COMPREHENSIVE RESPONSIVE DESIGN ===== */
/* Base: prevent ALL overflow */
*{box-sizing:border-box}
img,video,iframe{max-width:100%;height:auto}
.screen{padding:16px 14px;overflow-x:hidden}

/* Cards don't overflow */
.card{overflow:hidden;word-break:break-word}
.child-card,.shop-item,.deed-btn,.quest-item{word-break:break-word;overflow:hidden}

/* Text truncation for names */
.child-card .bold,.shop-item .bold{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:100%}

/* ---- 320px — very small phones ---- */
@media(max-width:360px){
  html{font-size:13.5px}
  .screen{padding:12px 10px}
  .timer-display{font-size:2rem!important}
  .welcome-title{font-size:1.7rem}
  .welcome-moon{font-size:3.5rem}
  .stats-grid{grid-template-columns:repeat(2,1fr)!important}
  .deeds-grid{grid-template-columns:repeat(2,1fr)!important}
  .ptab-btn{font-size:0.7rem;padding:8px 4px;min-height:52px}
  .ptab-btn span{font-size:0.68rem}
  #app{padding-bottom:70px}
  .btn{font-size:0.9rem;padding:11px 14px}
  .cert-name{font-size:1.4rem!important}
}

/* ---- 361–480px — typical phones ---- */
@media(min-width:361px) and (max-width:480px){
  html{font-size:15px}
  .stats-grid{grid-template-columns:repeat(2,1fr)!important}
}

/* ---- 481–767px — large phones / small tablets ---- */
@media(min-width:481px){
  html{font-size:15.5px}
  .deeds-grid{grid-template-columns:repeat(3,1fr)!important}
  .stats-grid{grid-template-columns:repeat(4,1fr)!important}
  .ach-grid{grid-template-columns:repeat(4,1fr)!important}
  .shop-grid{grid-template-columns:repeat(3,1fr)!important}
  #app{max-width:540px}
  #nav{max-width:540px}
}

/* ---- 768px+ — tablets ---- */
@media(min-width:768px){
  html{font-size:16.5px}
  .screen{padding:22px 20px}
  #app{max-width:620px}
  #nav{max-width:620px}
  .ptab-btn{font-size:0.85rem;padding:12px 8px}
}

/* ---- 1024px+ — desktop ---- */
@media(min-width:1024px){
  html{font-size:17px}
  #app{max-width:700px}
  #nav{max-width:700px}
}
  #sync-indicator{position:fixed;top:8px;left:50%;transform:translateX(-50%);background:var(--color-primary);color:var(--color-on-primary);padding:3px 12px;border-radius:18px;font-size:0.72rem;font-weight:700;opacity:0;transition:opacity .3s;z-index:999;pointer-events:none}
  #sync-indicator.syncing{opacity:1}
  /* ============ RESPONSIVE BREAKPOINTS ============ */
@media(max-width:375px){html{font-size:14px}.timer-display{font-size:2.2rem}.cert-name{font-size:1.5rem}}
@media(min-width:600px){.deeds-grid{grid-template-columns:repeat(3,1fr)}.stats-grid{grid-template-columns:repeat(4,1fr)}.ach-grid{grid-template-columns:repeat(4,1fr)}.shop-grid{grid-template-columns:repeat(3,1fr)}}
@media(min-width:768px){html{font-size:17px}#app{max-width:600px}#nav{max-width:600px}.screen{padding:24px 20px}}
@media(min-width:1024px){html{font-size:18px}#app{max-width:680px}#nav{max-width:680px}}
/* Prevent horizontal overflow (safe) */
img,video,canvas,svg{max-width:100%;height:auto}
.card,.shop-item,.quiz-opt{overflow-wrap:break-word}

/* ============ SCREENS ============ */
.screen{display:none;flex-direction:column;padding:20px 16px;min-height:calc(100vh - 80px);animation:fadeIn .2s ease}
.screen.active{display:flex}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.screen-title{font-size:1.3rem;font-weight:900;color:var(--accent);margin-bottom:16px;text-align:center}

/* ============ BUTTONS ============ */
.btn{
  display:inline-flex;align-items:center;justify-content:center;gap:6px;
  padding:13px 20px;border-radius:var(--r);border:none;font-family:var(--font);
  font-size:1rem;font-weight:700;cursor:pointer;transition:all .2s;min-height:44px;
}
.btn:active{transform:scale(0.95);opacity:0.9}
.btn-block{width:100%}
.btn-lg{padding:16px 24px;font-size:1.1rem;border-radius:22px}
.btn-sm{padding:9px 13px;font-size:0.85rem;border-radius:11px;min-height:40px}
.btn-primary{background:var(--accent);color:var(--text-on-accent)}
.btn-secondary{background:var(--teal);color:var(--color-on-secondary)}
.btn-danger{background:var(--rose);color:var(--color-on-danger)}
.btn-ghost{background:var(--surf);color:var(--text);border:1.5px solid var(--bdr)}
.btn-outline{background:transparent;color:var(--accent);border:2px solid var(--accent)}
.btn-success{background:var(--green);color:var(--color-on-success)}
.btn:disabled{opacity:0.4;cursor:not-allowed;transform:none}

/* ============ CARDS / FORMS ============ */
.card{background:var(--surf);border:1px solid var(--bdr);border-radius:var(--r);padding:16px;margin-bottom:10px}
.card-accent{border-color:var(--color-primary);background:var(--color-surf-low)}
input,textarea,select{
  width:100%;padding:11px 13px;background:var(--surf);border:1.5px solid var(--bdr);
  border-radius:12px;color:var(--text);font-family:var(--font);font-size:1rem;outline:none;min-height:44px;
}
input:focus,textarea:focus,select:focus{border-color:var(--accent)}
select option{background:var(--bg2);color:var(--text)}
input[type=range]{-webkit-appearance:none;appearance:none;height:6px;border-radius:3px;background:var(--surf2);padding:0;border:none}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:22px;height:22px;border-radius:50%;background:var(--accent);cursor:pointer}

/* ============ UTILS ============ */
.hidden{display:none!important}
.flex{display:flex;align-items:center}
.flex-col{display:flex;flex-direction:column}
.gap-6{gap:6px}.gap-8{gap:8px}.gap-10{gap:10px}.gap-12{gap:12px}
.mt-8{margin-top:8px}.mt-12{margin-top:12px}.mt-16{margin-top:16px}
.mb-8{margin-bottom:8px}.mb-12{margin-bottom:12px}
.text-center{text-align:center}.text-sm{font-size:0.88rem}.text-xs{font-size:0.74rem}
.text-muted{color:var(--muted)}.bold{font-weight:700}.text-accent{color:var(--accent)}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}

/* ============ WELCOME ============ */
.welcome-wrap{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:18px;text-align:center;padding:20px 0}
.welcome-moon{font-size:5rem;animation:float 3s ease-in-out infinite}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
.welcome-title{font-size:2.1rem;font-weight:900;font-family:'Amiri',serif;line-height:1.2;color:var(--accent)}
.welcome-sub{color:var(--muted);font-size:0.95rem}
.profile-entry-btn{background:var(--surf);border:1.5px solid var(--bdr);border-radius:16px;padding:11px 14px;display:flex;align-items:center;gap:12px;width:100%;color:var(--text);font-family:var(--font);font-size:0.95rem;font-weight:700;cursor:pointer}
.profile-entry-btn:active{transform:scale(0.97)}

/* ============ SETUP ============ */
.setup-step{display:none;flex-direction:column;gap:12px;flex:1}
.setup-step.active{display:flex}
.step-hdr{text-align:center;margin-bottom:6px}
.step-icon{font-size:3rem}
.avatar-tabs{display:flex;gap:6px;overflow-x:auto;padding-bottom:4px;margin-bottom:8px}
.avatar-tab{flex-shrink:0;padding:5px 12px;border-radius:20px;border:1.5px solid var(--bdr);background:var(--surf);font-size:0.8rem;cursor:pointer;color:var(--muted);font-family:var(--font);font-weight:700}
.avatar-tab.active{background:var(--accent);color:var(--text-on-accent);border-color:var(--accent)}
.avatar-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}
.av-btn{aspect-ratio:1;background:var(--surf);border:2px solid var(--bdr);border-radius:12px;font-size:1.6rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s}
.av-btn.selected{border-color:var(--color-primary);background:var(--color-surf-mid);transform:scale(1.1)}
.hero-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.hero-btn{background:var(--surf);border:2px solid var(--bdr);border-radius:14px;padding:12px 8px;text-align:center;cursor:pointer;transition:all .15s}
.hero-btn.selected{border-color:var(--color-primary);background:var(--color-surf-mid)}
.hero-icon{font-size:1.8rem}
.color-grid{display:grid;grid-template-columns:repeat(8,1fr);gap:6px}
.color-sw{aspect-ratio:1;border-radius:50%;cursor:pointer;border:3px solid transparent;transition:all .15s;min-height:28px}
.color-sw.selected{border-color:var(--text);transform:scale(1.2)}
.diff-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.diff-btn{background:var(--surf);border:2px solid var(--bdr);border-radius:14px;padding:14px 6px;text-align:center;cursor:pointer;transition:all .15s}
.diff-btn.selected{border-color:var(--color-primary);background:var(--color-surf-mid)}
.slider-lbl{display:flex;justify-content:space-between;font-weight:700;font-size:0.9rem;margin-bottom:5px}
.slider-val{color:var(--accent);font-weight:900}
.total-info{text-align:center;padding:8px 12px;border-radius:12px;background:var(--surf);font-size:0.85rem;font-weight:700;color:var(--color-secondary)}

/* ============ NAV ============ */
#nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:520px;background:var(--bg2);border-top:1px solid var(--bdr);display:none;grid-template-columns:repeat(5,1fr);z-index:100;padding-bottom:env(safe-area-inset-bottom,0)}
#nav.show{display:grid}
.nav-btn{display:flex;flex-direction:column;align-items:center;padding:10px 2px;background:none;border:none;color:var(--muted);font-family:var(--font);font-size:0.68rem;cursor:pointer;gap:2px;transition:color .15s;min-height:52px}
.nav-btn.active{color:var(--accent)}
.nav-i{font-size:1.25rem}

/* ============ HOME ============ */
.home-hdr{display:flex;align-items:center;gap:12px;margin-bottom:14px}
.home-av{font-size:2.8rem;cursor:pointer}
.home-name{font-size:1.25rem;font-weight:900}
.home-greet{font-size:0.82rem;color:var(--muted)}
.day-badge{background:var(--accent);color:var(--text-on-accent);font-weight:900;padding:4px 12px;border-radius:20px;font-size:0.88rem;white-space:nowrap;flex-shrink:0}
.timer-card{background:linear-gradient(135deg,var(--bg2),var(--bg3));border:2px solid var(--accent);border-radius:24px;padding:18px;text-align:center;margin-bottom:14px}
.timer-lbl{color:var(--muted);font-size:0.82rem}
.timer-name{font-size:1.05rem;font-weight:700;color:var(--accent);margin:2px 0 6px}
.timer-display{font-size:2.8rem;font-weight:900;font-variant-numeric:tabular-nums;letter-spacing:2px}
.prog-track{height:8px;background:var(--surf);border-radius:4px;position:relative;overflow:visible;margin-top:12px}
.prog-fill{height:100%;border-radius:4px;background:linear-gradient(90deg,var(--color-secondary),var(--color-primary));transition:width .5s}
.prog-labels{display:flex;justify-content:space-between;font-size:0.72rem;color:var(--muted);margin-bottom:3px}
.prog-marker{position:absolute;top:-4px;width:16px;height:16px;border-radius:50%;background:var(--accent);border:2px solid var(--bg);transform:translateX(50%);transition:right .5s}
.status-card{border-radius:16px;padding:12px 14px;margin-bottom:12px;font-size:0.9rem}
.status-pending{background:var(--color-surf-low);border:1.5px solid var(--color-primary)}
.status-success{background:var(--color-surf-low);border:1.5px solid var(--color-success)}
.status-broke{background:var(--color-surf-low);border:1.5px solid var(--color-danger)}
.quiz-banner{background:linear-gradient(135deg,var(--color-bg-surface),var(--color-surf-low));border:2px solid var(--color-primary);border-radius:18px;padding:16px;display:flex;align-items:center;gap:12px;margin-bottom:14px}
.section-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.section-title{font-weight:800;font-size:0.95rem}
.badge{background:var(--accent);color:var(--text-on-accent);font-size:0.72rem;font-weight:700;padding:2px 8px;border-radius:10px}
.deeds-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:12px}
.deed-btn{background:var(--surf);border:2px solid var(--bdr);border-radius:13px;padding:10px 6px;text-align:center;cursor:pointer;transition:all .15s;font-family:var(--font);min-height:78px;position:relative;color:var(--text)}
.deed-btn .deed-icon{font-size:1.6rem;display:block}
.deed-btn .deed-name{font-size:0.72rem;font-weight:700;display:block;margin:4px 0 2px;color:var(--text);line-height:1.2}
.deed-btn .deed-pts{font-size:0.68rem;color:var(--accent);font-weight:700}
.deed-btn.done{border-color:var(--color-success);background:var(--color-surf-mid)}
.deed-btn.done .deed-name,.deed-btn.done .deed-pts{color:var(--text-on-done)}
.deed-btn.pending-approval{border-color:var(--color-primary);background:var(--color-surf-low)}
.deed-btn.pending-approval .deed-pts{color:var(--accent)}
.deed-icon{font-size:1.4rem}
.deed-name{font-size:0.74rem;font-weight:700;margin-top:3px}
.deed-pts{font-size:0.68rem;color:var(--accent)}
.quest-item{background:var(--surf);border:1px solid var(--bdr);border-radius:12px;padding:9px 11px;display:flex;align-items:center;gap:9px;cursor:pointer;margin-bottom:6px;font-family:var(--font);min-height:48px}
.q-check{width:22px;height:22px;border-radius:50%;border:2px solid var(--bdr);display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:0.72rem;font-weight:900;transition:all .15s}
.q-check.done{background:var(--color-success);border-color:var(--color-success);color:var(--color-on-success)}
.q-pts{color:var(--accent);font-weight:700;font-size:0.82rem;flex-shrink:0}
.bad-deed-item{background:var(--color-surf-low);border:1px solid var(--color-danger);border-radius:11px;padding:8px 12px;display:flex;align-items:center;gap:8px;margin-bottom:5px;font-size:0.85rem}
.pts-popup{position:fixed;font-size:1.3rem;font-weight:900;color:var(--accent);pointer-events:none;z-index:9000;animation:ptsFly 1.2s ease forwards}
@keyframes ptsFly{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-80px) scale(1.3)}}
.pts-neg{color:var(--color-danger)}
.notif-bar{background:var(--surf);border:1px solid var(--bdr);border-radius:13px;padding:10px 13px;display:flex;align-items:center;gap:9px;margin-bottom:10px}
.install-bar{background:linear-gradient(135deg,var(--color-surf-low),var(--color-surf-mid));border:2px solid var(--color-primary);border-radius:14px;padding:12px 14px;display:flex;align-items:center;gap:10px;margin-bottom:10px}

/* ============ PROGRESS ============ */
.xp-bar-wrap{background:var(--surf);border:1px solid var(--bdr);border-radius:15px;padding:13px;margin-bottom:12px}
.xp-header{display:flex;justify-content:space-between;margin-bottom:5px}
.level-badge{background:var(--accent);color:var(--text-on-accent);padding:3px 10px;border-radius:10px;font-size:0.78rem;font-weight:700}
.xp-track{height:10px;background:var(--surf2);border-radius:5px;overflow:hidden}
.xp-fill{height:100%;background:linear-gradient(90deg,var(--color-secondary),var(--color-primary));transition:width .5s}
.stats-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:12px}
.stat-card{background:var(--surf);border:1px solid var(--bdr);border-radius:13px;padding:11px;text-align:center}
.stat-val{font-size:1.5rem;font-weight:900;color:var(--accent)}
.stat-lbl{font-size:0.72rem;color:var(--muted);margin-top:2px}
.journey-item{display:flex;align-items:center;gap:10px;padding:9px 12px;border-radius:11px;background:var(--surf);border:1px solid var(--bdr);margin-bottom:6px}
.journey-item.done{border-color:var(--color-success)}
.journey-item.current{border-color:var(--color-primary);background:var(--color-surf-low)}
.ach-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:7px}
.ach-card{background:var(--surf);border:1px solid var(--bdr);border-radius:11px;padding:9px 5px;text-align:center}
.ach-card.unlocked{border-color:var(--color-primary);background:var(--color-surf-low)}

/* ============ LOG ============ */
.log-item{background:var(--surf);border:1px solid var(--bdr);border-radius:11px;padding:9px 12px;margin-bottom:6px;font-size:0.85rem}
.log-pending{border-color:var(--accent)}
.log-approved{border-color:var(--color-success)}
.log-rejected{border-color:var(--color-danger)}
.log-meta{display:flex;justify-content:space-between;align-items:center;font-size:0.75rem;color:var(--muted);margin-top:4px}

/* ============ SHOP ============ */
.shop-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px}
.shop-item{background:var(--surf);border:1px solid var(--bdr);border-radius:15px;padding:13px;text-align:center}
.shop-item.owned{border-color:var(--color-success)}

/* ============ PARENT ============ */
.parent-lock{display:flex;flex-direction:column;align-items:center;gap:13px;text-align:center;padding:18px 0}
.math-q{font-size:1.9rem;font-weight:900;background:var(--surf);padding:12px 24px;border-radius:14px;color:var(--accent)}
.table-wrap{overflow-x:auto;border-radius:12px;border:1px solid var(--bdr)}
table{width:100%;border-collapse:collapse;font-size:0.82rem}
th{background:var(--bg3);padding:8px 10px;font-weight:700;color:var(--accent);border-bottom:1px solid var(--bdr);white-space:nowrap}
td{padding:8px 10px;border-bottom:1px solid var(--surf);color:var(--text);vertical-align:middle}
tr:last-child td{border-bottom:none}
tr:hover td{background:var(--surf)}
.child-card{display:flex;align-items:center;gap:11px;background:var(--surf);border:1.5px solid var(--bdr);border-radius:14px;padding:11px 13px;margin-bottom:7px}

/* ============ QUIZ ============ */
.quiz-prog{height:6px;background:var(--surf);border-radius:3px;margin-bottom:13px;overflow:hidden}
.quiz-prog-fill{height:100%;background:linear-gradient(90deg,var(--color-secondary),var(--color-primary));border-radius:3px;transition:width .3s}
.quiz-meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;font-size:0.83rem}
.quiz-q{background:var(--surf2);border:2px solid var(--bdr);border-radius:15px;padding:16px;font-size:1.05rem;font-weight:700;line-height:1.6;text-align:center;margin-bottom:14px;color:var(--text)}
.quiz-opts{display:flex;flex-direction:column;gap:9px}
.quiz-opt{background:var(--surf);border:2px solid var(--bdr);border-radius:13px;padding:12px 15px;font-size:0.92rem;font-weight:600;color:var(--text);font-family:var(--font);text-align:right;cursor:pointer;transition:all .2s;width:100%}
.quiz-opt:active{transform:scale(0.97)}
@media (hover:hover){
.quiz-opt:hover:not(:disabled){background:var(--surf2);border-color:var(--accent);transform:scale(1.01)}
}
.quiz-opt.correct{background:var(--color-success-dark);border-color:var(--color-success-dark);color:var(--color-on-success)!important;font-weight:800}
.quiz-opt.wrong{background:var(--color-danger-dark);border-color:var(--color-danger-dark);color:var(--color-on-danger)!important;font-weight:800}
.quiz-opt:disabled{cursor:not-allowed;opacity:.85}
.quiz-fb{margin-top:11px;padding:11px 15px;border-radius:13px;font-weight:800;text-align:center;font-size:0.95rem}
.quiz-fb.correct{background:var(--color-success-dark);color:var(--color-on-success);border:2px solid var(--color-success-dark)}
.quiz-fb.wrong{background:var(--color-danger-dark);color:var(--color-on-danger);border:2px solid var(--color-danger-dark)}
.quiz-locked{text-align:center;padding:30px 20px}
.quiz-locked-icon{font-size:3.5rem;margin-bottom:12px}

/* ============ CERTIFICATE ============ */
.cert-frame{background:linear-gradient(160deg,var(--color-bg-raised),var(--color-bg-surface),var(--color-bg));border:3px solid var(--color-primary);border-radius:24px;padding:26px 18px;text-align:center;position:relative;overflow:hidden}
[data-theme="night"] .cert-frame{background:linear-gradient(160deg,#1a2a5e,#0d1b3e,#1a0a3d)}
.cert-frame::before{content:'';position:absolute;inset:6px;border:1px solid var(--color-border);border-radius:18px;pointer-events:none}
.cert-name{font-size:1.9rem;font-weight:900;font-family:'Amiri',serif}
.cert-row{display:flex;justify-content:center;gap:20px;font-size:0.95rem;font-weight:700;color:var(--color-secondary);margin:10px 0}

/* ============ THEME PREVIEW ============ */
.theme-preview{background:var(--surf);border:1px solid var(--bdr);border-radius:14px;padding:13px;margin-bottom:8px}
.theme-preview-title{font-weight:800;font-size:0.9rem;color:var(--accent);margin-bottom:8px}
.preview-row{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:6px}

/* ============ THEME SWITCHER ============ */
.theme-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin:8px 0}
.theme-btn{border-radius:13px;padding:11px 5px;font-family:var(--font);font-size:0.78rem;font-weight:700;cursor:pointer;border:2px solid transparent;transition:all .2s;display:flex;flex-direction:column;align-items:center;gap:3px}
.theme-btn:active{transform:scale(0.95)}
.theme-btn.active{border-color:var(--text)!important;transform:scale(1.05)}
.t-night{background:linear-gradient(135deg,#162040,#0d1b3e);color:#ede4d3}
.t-day{background:linear-gradient(135deg,#fff4d6,#faf5ec);color:#1a0e00;border-color:#b07000}
.t-girls{background:linear-gradient(135deg,#ffe4f1,#fff0f7);color:#2a0016;border-color:#d4006e}
.t-boys{background:linear-gradient(135deg,#d4eedb,#e8f5ec);color:#081808;border-color:#1c7800}

/* ============ MODAL ============ */
.overlay{position:fixed;inset:0;background:var(--color-overlay);z-index:500;display:flex;align-items:flex-end;justify-content:center;animation:fadeIn .2s}
.overlay.center{align-items:center}
.sheet{background:var(--bg2);border-radius:24px 24px 0 0;padding:18px 15px 30px;width:100%;max-width:480px;border-top:1px solid var(--bdr);max-height:88vh;overflow-y:auto}
.sheet.center-sheet{border-radius:20px;margin:16px}
.sheet-handle{width:38px;height:4px;background:var(--surf2);border-radius:2px;margin:0 auto 14px}
.modal-title{font-size:1.05rem;font-weight:800;color:var(--accent);margin-bottom:13px;text-align:center}

/* ============ TOAST & CONFETTI ============ */
#toast{position:fixed;top:18px;left:50%;transform:translateX(-50%) translateY(-10px);background:var(--bg2);border:1.5px solid var(--accent);border-radius:20px;padding:9px 18px;font-size:0.88rem;font-weight:700;z-index:9999;white-space:nowrap;max-width:90vw;box-shadow:var(--shadow);opacity:0;pointer-events:none;transition:all .3s}
#toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.conf-p{position:fixed;pointer-events:none;z-index:9998;border-radius:2px;animation:confFall linear forwards}
@keyframes confFall{0%{transform:translateY(-10px) rotate(0deg);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}

/* ============ EID ============ */
.eid-wrap{text-align:center;padding:26px 18px}
.winner-card{background:linear-gradient(135deg,var(--color-surf-low),var(--color-surf-mid));border:2px solid var(--color-primary);border-radius:18px;padding:16px;margin:12px 0}

/* ============ PRINT ============ */
@media print{body *{visibility:hidden}#screen-certificate,#screen-certificate *{visibility:visible}#screen-certificate{position:fixed;top:0;left:0;right:0;bottom:0}nav,.btn,button{display:none!important}}


/* ================================
   Home Inventory Slider (Cute)
================================ */
#inv-strip{
  display:flex;
  gap:12px;
  overflow-x:auto;
  padding:6px 2px 10px;
  scroll-snap-type:x mandatory;
  -webkit-overflow-scrolling:touch;
}
#inv-strip::-webkit-scrollbar{height:8px}
#inv-strip::-webkit-scrollbar-thumb{background:var(--color-surf-mid);border-radius:999px}
.inv-card{
  min-width:124px;
  max-width:140px;
  flex:0 0 auto;
  scroll-snap-align:start;
  background:var(--surf);
  border:1px solid var(--color-border);
  border-radius:16px;
  padding:10px 10px 12px;
  box-shadow:0 8px 18px rgba(0,0,0,.12);
  text-align:center;
}
.inv-ic{font-size:2rem;line-height:1.2}
.inv-n{font-size:.85rem;font-weight:800;margin-top:6px;opacity:.95}

/* Spacing so it doesn't stick to next section */
#home-inventory-card{margin-bottom:14px}

/* ================================
   Child Gifts
================================ */
.gift-card{
  display:flex;
  gap:10px;
  align-items:center;
  padding:10px;
  border-radius:16px;
  background:var(--surf);
  border:1px solid var(--color-border);
  margin-top:10px;
}
.gift-ic{font-size:1.8rem}
.gift-b{flex:1;min-width:0}
.gift-t{font-weight:900;font-size:.95rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.gift-m{display:flex;gap:8px;margin-top:6px;flex-wrap:wrap}

/* ================================
   Busy lock (prevent multi taps)
================================ */
body.is-busy #app{
  pointer-events:none;
  user-select:none;
  filter:saturate(.95);
}
body.is-busy #sync-indicator{
  opacity:1;
}
